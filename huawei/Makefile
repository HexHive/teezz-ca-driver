TCPRELOAD = tcpreload
SECURE_STORAGE = secure_storage
TEEZZ_EXECUTOR = teezz-executor
DEVICEID = BUC4C16B24013822

HUAWEI_SYSTEM_SERVER_LOGIN_BLOB = 11000000636f6d2e6875617765692e68696469736b0901000000010000e02c5ab97a2b3a8a5996223cde06b82b2d4ff5b15caf65b860d5c7a3d68995ab08620bb75a22fe7673a8a1aba03e17b651d1fc4d5cbdbae9e73eeeaf5a1d4d2fb73e7000231e0db2166d0fc5dd97e705fd66546c9da38ed4efa2cccdd238ad32e39821242b0195df01d9b97242dbf209eda8e446e043244b84e6bfca79d7bb3c1924cdd248edbd600eff8f73001a89a4c663db8970e3288b9431524c361e853b8fa29e04e61ebe6fbdbd87cdbd3eeb47b027b5851bdeaa13a23f43967a030e747ea432652cbb34fdde61049bf5060c813fb0e93f6bad9d36f4d4551195ea3bb49e9201aa6df975ae169e214905de2579d7cc3c3eac4594b14ac19d7e39c5c26701000000037a35d55edaf2e81f4ea9578119b77a3247c62f60719eb565ad27ec9837b9f307

.PHONY: build tcpreload

tcpreload:
	$(MAKE) -C $(TCPRELOAD)

$(SECURE_STORAGE): tcpreload
	$(MAKE) -C $(SECURE_STORAGE)
	adb -s $(DEVICEID) push $(TCPRELOAD)/$(TCPRELOAD) /data/local/tmp/
	adb -s $(DEVICEID) push $(SECURE_STORAGE)/$(SECURE_STORAGE) /data/local/tmp/
	adb -s $(DEVICEID) shell 'su -c "cd /data/local/tmp && chmod u+x ./$(SECURE_STORAGE) && cp ./$(SECURE_STORAGE) ./$(TEEZZ_EXECUTOR) && export LOGIN_BLOB=$(HUAWEI_SYSTEM_SERVER_LOGIN_BLOB) && LD_PRELOAD=./$(TCPRELOAD) ./$(TEEZZ_EXECUTOR)"'

hisilog:
	adb -s $(DEVICEID) shell 'su -c "cat /dev/hisi_teelog"'

dmesg:
	adb -s $(DEVICEID) shell su -c "dmesg -c"
